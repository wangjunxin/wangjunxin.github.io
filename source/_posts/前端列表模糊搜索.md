---
title: 前端模糊搜索
date: 2020-06-15 17:58:13
---

# 前端城市列表模糊搜索

Created By: junxin wang
Last Edited: Jun 15, 2020 9:16 PM
Tags: ideas

### 起因

前两天刷知乎看到一个阿里的面试题，说是城市列表的模糊搜索，例如a州能搜索到杭州

现有城市列表 ['杭州', '上海', '衢州', '三亚']
输入 a州
输出结果：杭州

### 思路

- 首先输入a州能匹配到杭州，也就是搜索需要支持拼音，其次a并不是杭字的首字母，所以需要对每个字符进行精确到单拼音的字节切分
- 针对之后需要切分搜索关键字来取得对应的结果，采用对象来存储数据（方便提取）
- 根据搜索关键字获取的数据后需要进行交集操作，所以以原数组的index作为城市的id，这样方便之后的交集操作
- 根据搜索关键字获得最后交集后，根据结果的index数组返回城市列表
- 返回结果还需要与关键字进行顺序匹配，筛除顺序不一致数据（TO DO）

### 不足

目前还没完善搜索关键字顺序造成的搜索结果问题，例如a州与州a的搜索结果一致，在州a的搜索结果中需要剔除例如杭州这类数据。（TO DO）

### 生成字符表

```jsx

const pinyin = require("pinyin");

let cnMap = {}
class fuzzySearch {
	formateCNMap(list) {
    sourceLsit = list
    list.forEach((item, index) => {
      for (let i of item) {
        this.formateMapforCN(i, index)
        if (this.isCN(i)) {
          this.dismantleCN(i, index)
        }
      }
    })
    console.log(cnMap)
  }
	// 检验输入是否为中文
  isCN(item) {
    const cn = /[\u4e00-\u9fa5]/
    return cn.test(item)
  }
	// 将中文转为拼音，然后根据拼音单字节放入表中，push的数据为数组的index
  dismantleCN(cn, index) {
    const result = pinyin(cn, {style: pinyin.STYLE_NORMAL})[0][0]
    for (let i of result) {
      if (cnMap[i]) {
        if (cnMap[i].indexOf(index) < 0) {
          cnMap[i].push(index)
        }
      } else {
        cnMap[i] = [index]
      }
    }
  }
  formateMapforCN(item, index) {
    if (cnMap[item]) {
      if (cnMap[item].indexOf(index) < 0) {
        cnMap[item].push(index)
      }
    } else {
      cnMap[item] = [index]
    }
  }
}

const fuzzysearch = new fuzzySearch()
const list = ['杭州', '上海', '重庆', '三亚']
fuzzysearch.formateCNMap(list)
```

```json
结果：
{
  '杭': [ 0 ],
  h: [ 0, 1, 2 ],
  a: [ 0, 1, 3 ],
  n: [ 0, 1, 2, 3 ],
  g: [ 0, 1, 2 ],
  '州': [ 0 ],
  z: [ 0, 2 ],
  o: [ 0, 2 ],
  u: [ 0 ],
  '上': [ 1 ],
  s: [ 1, 3 ],
  '海': [ 1 ],
  i: [ 1, 2 ],
  '重': [ 2 ],
  '庆': [ 2 ],
  q: [ 2 ],
  '三': [ 3 ],
  '亚': [ 3 ],
  y: [ 3 ]
}
```

### 搜索功能

```jsx

search(keys) {
    let result = []
    let first = true
    if (!this.checkKey(keys)) {
      return []
    }
		// 当搜索关键字在字符表中均存在的情况下
		// 第一个关键字匹配的字符表数据放入result中
    for (const key of keys) {
      if (cnMap[key] && first) {
        result = cnMap[key]
        first = false
      } else if (cnMap[key]) {
				//  之后的关键字匹配的数据与现有result结果取交集
        result = result.filter(function(v){ return cnMap[key].indexOf(v) > -1 })
      }
    }
		// 获得的结果交集是对应的source list的index数组
    const data = this.keyToData(result)
    return data;
  }
	// 检查搜索项在字符表中均存在，不存在则没有匹配结果
  checkKey(keys) {
    for (const key of keys) {
      if (!cnMap.hasOwnProperty(key)) {
        return false
      }
    }
    return true
  }
	// 根据index数组取回城市列表数据
  keyToData(list) {
    let result = []
    list.forEach(item => {
      result.push(sourceLsit[item])
    })
    return result;
  }

	fuzzysearch.search('a州') // [ '杭州' ]
```

### 结果

![输出结果](/images/fuzzySearchResult.png)

### 关键字顺序验证

to do